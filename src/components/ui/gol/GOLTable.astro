---
import type { CollectionEntry } from "astro:content";
import { createColumnHelper } from "@tanstack/table-core";
import DataTable from "./table/DataTable.astro";

interface Props {
	entry: CollectionEntry<"gol">;
}

const { entry } = Astro.props as Props;

const response = await fetch(entry.data.url)
	.then((res) => res.json())
	.catch((err) => {
		console.error("Error fetching GOL data:", entry.data, err);
		return null;
	});
if (!response) {
	return;
}

type TableData = {
	link: string;
	subtitle: string;
};

const data: TableData[] = (response.data as string[][]).map((item) => ({
	link: item[1] ?? "",
	subtitle: item[3] ?? "",
}));

const columnHelper = createColumnHelper<TableData>();

const columns = [
	columnHelper.accessor("link", {
		header: "GIF Link",
		cell: (info) => info.getValue(),
	}),
	columnHelper.accessor("subtitle", {
		header: "Subtitle",
		cell: (info) => info.getValue(),
	}),
];
---

<DataTable caption={entry.data.name} {columns} {data} />
