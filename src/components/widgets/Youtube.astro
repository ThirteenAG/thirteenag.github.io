---
import YoutubeLogo from "@/assets/icons/youtube-red.svg";

interface Props {
	src: string;
}

const { src } = Astro.props;

const re =
	/(?:youtube(?:-nocookie)?\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([A-Za-z0-9_-]{11})/;

const match = src.match(re);
if (!match) {
	return null;
}

const videoId = match[1];
---

<div
	data-id={videoId}
	class="youtube-player h-full w-full overflow-hidden bg-black"
>
	<div class="relative h-full w-full">
		<img
			src={"//i.ytimg.com/vi/" + videoId + "/hqdefault.jpg"}
			alt="YouTube Video"
			class="h-full w-full object-cover cursor-pointer transition-all duration-400"
			loading="lazy"
			decoding="async"
		/>
		<div
			class="absolute top-0 left-0 right-0 bottom-0 cursor-pointer flex items-center justify-center hover:bg-black/20"
		>
			<YoutubeLogo height="48px" />
		</div>
	</div>
</div>

<script>
	/*
	 * Light YouTube Embeds by @labnol
	 * Credit: https://www.labnol.org/
	 */

	function labnolIframe(div: HTMLDivElement) {
		var iframe = document.createElement("iframe");
		iframe.setAttribute(
			"src",
			"https://www.youtube.com/embed/" + div.dataset.id + "?autoplay=1",
		);
		iframe.setAttribute("frameborder", "0");
		iframe.setAttribute("allowfullscreen", "1");
		iframe.setAttribute(
			"allow",
			"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",
		);
		iframe.style.width = "100%";
		iframe.style.height = "100%";
		div.replaceChildren(iframe);
	}

	const players = document.querySelectorAll(".youtube-player");
	players.forEach((player) => {
		player.addEventListener("click", function (e: Event) {
			const target = e.currentTarget as HTMLDivElement | null;
			if (target) labnolIframe(target);
		});
	});
</script>
